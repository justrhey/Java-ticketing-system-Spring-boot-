<!DOCTYPE html>
<html>
<head>
    <title>Ticket Management - Admin</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
        <link href="/css/style.css" rel="stylesheet">
        <div class="d-flex justify-content-between align-items-center mb-4">
 

</head>
<body>
   <div>
        <h1>Ticket Management - Admin Panel</h1>
        <small class="text-muted">Logged in as: <strong th:text="${adminEmail}">admin@company.com</strong></small>
    </div>
    <div>
        <a href="/user/tickets" class="btn btn-outline-primary">User View</a>
        <a href="/admin/logout" class="btn btn-outline-danger">Logout</a>
        <a href="/user/tickets/new" class="btn btn-primary">Create New Ticket</a>
    </div>
</div>
        <div th:if="${tickets.empty}" class="alert alert-warning">
            No tickets in the system.
        </div>
        
        <div th:unless="${tickets.empty}">
            <div class="table-responsive">
                <table class="table table-striped table-hover">
                    <thead class="table-dark">
                        <tr>
                            <th>ID</th>
                            <th>Title</th>
                            <th>Status</th>
                            <th>Priority</th>
                            <th>Created By</th>
                            <th>Assigned To</th>
                            <th>Created</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="ticket : ${tickets}">
                            <td th:text="${ticket.id}">#</td>
                            <td th:text="${ticket.title}">Title</td>
                            <td>
                                <form th:action="@{/admin/tickets/{id}/status(id=${ticket.id})}" 
                                      method="post" class="d-inline">
                                    <select name="status" onchange="this.form.submit()" 
                                            th:class="${'form-select form-select-sm ' + 
                                                (ticket.status == 'OPEN' ? 'border-primary' : 
                                                 ticket.status == 'IN_PROGRESS' ? 'border-warning' : 
                                                 ticket.status == 'RESOLVED' ? 'border-success' : 'border-secondary')}">
                                        <option value="OPEN" th:selected="${ticket.status == 'OPEN'}">Open</option>
                                        <option value="IN_PROGRESS" th:selected="${ticket.status == 'IN_PROGRESS'}">In Progress</option>
                                        <option value="RESOLVED" th:selected="${ticket.status == 'RESOLVED'}">Resolved</option>
                                        <option value="CLOSED" th:selected="${ticket.status == 'CLOSED'}">Closed</option>
                                    </select>
                                </form>
                            </td>
           <td>
    <span th:class="${'badge ' + 
        (ticket.priority == 'LOW' ? 'badge-priority-low' : 
         ticket.priority == 'MEDIUM' ? 'badge-priority-medium' : 
         ticket.priority == 'HIGH' ? 'badge-priority-high' : 'badge-priority-critical')}"
        th:text="${ticket.priority}">
    </span>
</td>
                            <td th:text="${ticket.createdBy}">User</td>
                            <td th:text="${ticket.assignedTo} ?: 'Unassigned'">Assignee</td>
                            <td th:text="${#temporals.format(ticket.createdAt, 'MMM dd, HH:mm')}">Date</td>
                            <td>
                                <div class="btn-group btn-group-sm">
                                    <a th:href="@{/user/tickets/{id}(id=${ticket.id})}" 
                                       class="btn btn-outline-info">View</a>
                                    <a th:href="@{/admin/tickets/{id}/edit(id=${ticket.id})}" 
                                       class="btn btn-outline-warning">Edit</a>
                                    <form th:action="@{/admin/tickets/{id}/delete(id=${ticket.id})}" 
                                          method="post" class="d-inline">
                                        <button type="submit" class="btn btn-outline-danger" 
                                                onclick="return confirm('Delete this ticket?')">Delete</button>
                                    </form>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</body>
</html>